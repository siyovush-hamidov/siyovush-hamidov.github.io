<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         Uniswap V1_V2_V3 Overview
        
    </title><meta content="Uniswap V1_V2_V3 Overview" property=og:title><meta content="Blockchain Security Researcher" property=og:description><meta content="Blockchain Security Researcher" name=description><link href=/favicons/favicon.ico rel=icon type=image/png><link href=https://siyovush-hamidov.github.io/fonts.css rel=stylesheet><script src=https://siyovush-hamidov.github.io/js/codeblock.js></script><script src=https://siyovush-hamidov.github.io/js/toc.js></script><script src=https://siyovush-hamidov.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Siyovush Hamidov" href=https://siyovush-hamidov.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://siyovush-hamidov.github.io/theme/light.css rel=stylesheet><link href=https://siyovush-hamidov.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://siyovush-hamidov.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://siyovush-hamidov.github.io/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://siyovush-hamidov.github.io/>Siyovush Hamidov</a><div class=socials><a class=social href=https://x.com/HamidovSiyovush/ rel=me target=_blank> <img alt=twitter src=https://siyovush-hamidov.github.io/social_icons/twitter.svg> </a><a class=social href=https://www.linkedin.com/in/siyovush-hamidov/ rel=me target=_blank> <img alt=linkedin src=https://siyovush-hamidov.github.io/social_icons/linkedin.svg> </a><a class=social href=https://github.com/siyovush-hamidov/ rel=me target=_blank> <img alt=github src=https://siyovush-hamidov.github.io/social_icons/github.svg> </a><a href="mailto: siyovushchik14@gmail.com" class=social rel=me target=_blank> <img alt=Email src=https://siyovush-hamidov.github.io/social_icons/email.svg> </a></div></div><nav><a href=https://siyovush-hamidov.github.io/writeups style=margin-left:.5em>/writeups</a><a href=https://siyovush-hamidov.github.io/projects style=margin-left:.5em>/projects</a><a href=https://siyovush-hamidov.github.io/contact style=margin-left:.5em>/contact</a> |<a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://siyovush-hamidov.github.io/feather/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://siyovush-hamidov.github.io/feather/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><main><article><div class=title><div class=page-header>Uniswap V1_V2_V3 Overview<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2024-01-09</time><span class=tags-label> :: Tags:</span><span class=tags> <a class=post-tag href=https://siyovush-hamidov.github.io/tags/web3/>web3</a>, <a class=post-tag href=https://siyovush-hamidov.github.io/tags/defi/>defi</a> </span></div></div><div class=toc-container><h1 class=toc-title>Table of Contents</h1><ul class=toc-list><li><a href=https://siyovush-hamidov.github.io/posts/uniswap-overview/#uniswap>Uniswap</a><li><a href=https://siyovush-hamidov.github.io/posts/uniswap-overview/#uniswap-v1>Uniswap V1</a><li><a href=https://siyovush-hamidov.github.io/posts/uniswap-overview/#uniswap-v2>Uniswap V2</a> <ul><li><a href=https://siyovush-hamidov.github.io/posts/uniswap-overview/#twap>TWAP</a></ul><li><a href=https://siyovush-hamidov.github.io/posts/uniswap-overview/#uniswap-v3>Uniswap V3</a> <ul><li><a href=https://siyovush-hamidov.github.io/posts/uniswap-overview/#references>References</a></ul></ul></div><section class=body><p>Hey hi all, I got something useful for all web3 learners. Past few days I spent to understand bits and bytes of the Uniswap Protocol. I gathered the best resources to learn all the things about Uniswap V2. During my learning I have taken notes of every thing that I learned. In this post you can get an gist of <strong>Uniswap DEX</strong> Protocol. You can check my <a href=https://themj0ln1r.github.io/posts/uniswapv2complete>Uniswap V2 Complete Code Walkthrough</a> post to learn everything about Uniswap V2.<h1 id=uniswap><a aria-label="Anchor link for: uniswap" class=zola-anchor href=#uniswap>Uniswap</a></h1><p>Uniswap is an automated ethereum-based crypto exchange with its own governance token, UNI.<h1 id=uniswap-v1><a aria-label="Anchor link for: uniswap-v1" class=zola-anchor href=#uniswap-v1>Uniswap V1</a></h1><p>It introduced the ETH/ERC20 liquidity pool, where LPs (Liquidity Providers) could deposit tokens in exchange for liquidity tokens.<p>Uniswap V1 uses the <code>X * Y = K</code> constant product equation to calculate token price where<p>X is the amount of token 1,<p>Y is the amount of token 2, and<p>K is the constant that the liquidity pool’s smart contract keeps the same throughout swaps.<p>Uniswap V1 model faces many issues involving <strong>slippage</strong> - the change in price of a token because of your trade, and a <strong>lack of dedicated token-only pools</strong> that forces users to interact with two pools to trade between non-native tokens.</p><img src=/assets/img/blog_img/uniswap-overview/uniswapv1_dai_usdc.png><p>First, the buyer interacts with the <strong>DAI/ETH</strong> pool to swap his <strong>DAI</strong> for <strong>ETH</strong>, then uses that <strong>ETH</strong> to interact with the <strong>USDC/ETH</strong> pool which outputs <strong>USDC</strong> in exchange for the <strong>ETH</strong>.<p>Uniswap V1 has a flat <strong>0.3%</strong> fee for LPs (Liquidity Providers) to incentivize participation in the network, which must be taken into account as well in the equation.<p><strong>Weakness :</strong><ul><li>Uniswap V1 model faces is the weakness to price manipulation like <strong>front-running</strong> and <strong>sandwich attacks</strong></ul><h1 id=uniswap-v2><a aria-label="Anchor link for: uniswap-v2" class=zola-anchor href=#uniswap-v2>Uniswap V2</a></h1><p>The Uniswap V2 was launched in May, 2020 with a plethora of new features including <strong>TWAP</strong> (Time Weighted Average Price), <strong>Liquidity pools</strong> <strong>for non-native tokens</strong> which halves gas fees and slippage for token swaps, and <strong>Flash Swaps</strong>. In addition, this update removed native token functionality in favor of <strong>WETH</strong> (Wrapped Ether) and is written in Solidity - a welcome change for readability.<p>The <strong>0.3%</strong> fee model was shortly modified after release by members of the DAO, where <strong>0.05%</strong> of the fee’s funds are reserved for the development of the Uniswap network.<h3 id=twap><a aria-label="Anchor link for: twap" class=zola-anchor href=#twap><strong>TWAP</strong></a></h3><p><strong>TWAP</strong> works by averaging a price for a token in a pool over a set period of time, making manipulating prices extremely difficult. Each new block pairs measure the market price before trades take place.</p><img src=/assets/img/blog_img/uniswap-overview/uniswapv2_cumulative.png><p>Let’s say we wish to measure the <strong>TWAP</strong> of a token price over a set of time <code>T</code>. The equation to find the TWAP price is calculated by dividing the cumulative price (or the aforementioned <code>priceCumulative</code> variable in the pictures) by <code>T</code>.<p>This gives us an average price that is resilient to an outlier price given by the oracle. For example, if a token were to be manipulated at block <strong>10</strong> with an <em>outrageous</em> price, instead of drawing this inaccurate reading to be the true price of swap, it is averaged between blocks <strong>6</strong>, <strong>7</strong>, <strong>8</strong>, and <strong>9</strong> which read much closer to the accurate price. Therefore, <strong>much</strong> less slippage/manipulation is realized by the end user.</p><img src=/assets/img/blog_img/uniswap-overview/uniswapv2_twap.png><p><strong>Flash Swaps :</strong><p><strong>Uniswap V2 flash swaps</strong> allow you to withdraw as much as you want of any ERC20 token on Uniswap at no upfront cost and do anything you want with them (execute arbitrary code), provided that by the end of the transaction execution, you either:<ul><li>Pay for all ERC20 tokens withdrawn<li>Pay for a percentage of ERC20 tokens and return the rest<li>Return all ERC20 tokens withdrawn</ul><p>Liquidity provider fees are enforced by subtracting 0.3% from all input amounts, even if the input ERC20 tokens are being returned as part of a flash swap.</p><img src=/assets/img/blog_img/uniswap-overview/uniswapv2_flash.png><h1 id=uniswap-v3><a aria-label="Anchor link for: uniswap-v3" class=zola-anchor href=#uniswap-v3>Uniswap V3</a></h1><p>Uniswap V3 was launched on May 5, 2021 with numerous features among many others: <strong>concentrated liquidity</strong>, <strong>multiple fee tiers</strong>, <strong>non-fungible liquidity</strong>, and <strong>improved TWAP oracles</strong>.<ul><li><strong>Concentrated liquidity :</strong> Giving individual LPs granular control over what price ranges their capital is allocated to. Individual positions are aggregated together into a single pool, forming one combined curve for users to trade against<li><strong>Multiple fee tiers :</strong> Allowing LPs to be appropriately compensated for taking on varying degrees of risk<li><strong>Non-fungible liquidity :</strong> As a byproduct of per-LP custom price curves, liquidity positions are no longer fungible and are not represented as ERC20 tokens in the core protocol.<li><strong>Improved TWAP Oracles :</strong> Uniswap v3 offers significant improvements to the TWAP oracle, making it possible to calculate any recent TWAP within the past ~9 days in a single on-chain call. This is achieved by storing an array of cumulative sums instead of just one.<li><strong>Improved TWAP Oracles :</strong> Uniswap v3 offers significant improvements to the TWAP oracle, making it possible to calculate any recent TWAP within the past ~9 days in a single on-chain call. This is achieved by storing an array of cumulative sums instead of just one.</ul><h2 id=references><a aria-label="Anchor link for: references" class=zola-anchor href=#references>References</a></h2><ul><li><a href=https://docs.uniswap.org/concepts/uniswap-protocol target=_blank>Uniswap Docs</a></ul><hr><p>Thank you &LT3</section></article></main></div>